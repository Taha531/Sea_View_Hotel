<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Manager Dashboard - Sea View Hotel</title>
    <style>
      body {
        font-family: Arial;
        background: #f0f0f0;
        margin: 0;
        padding: 0;
      }
      header {
        background: #004080;
        color: white;
        padding: 20px;
        text-align: center;
      }
      header h1 {
        margin: 0;
      }
      nav.tabs {
        display: flex;
        background: #0066cc;
      }
      nav.tabs button {
        flex: 1;
        padding: 15px;
        border: none;
        background: #0066cc;
        color: white;
        cursor: pointer;
      }
      nav.tabs button.active {
        background: #003366;
      }
      section {
        display: none;
        max-width: 1200px;
        margin: 20px auto;
        background: white;
        padding: 20px;
        border-radius: 10px;
      }
      section.active {
        display: block;
      }
      table {
        width: 100%;
        border-collapse: collapse;
      }
      th,
      td {
        border: 1px solid #ccc;
        padding: 8px;
        text-align: left;
      }
      th {
        background: #eee;
      }
      button.logout {
        background: #004080;
        color: white;
        border: none;
        padding: 10px 20px;
        cursor: pointer;
        margin-top: 10px;
        border-radius: 5px;
      }
      button.logout:hover {
        background: #003366;
      }
    </style>
  </head>
  <body>
    <header>
      <h1>Manager Dashboard - Sea View Hotel</h1>
      <button class="logout" id="logoutBtn">Logout</button>
    </header>

    <nav class="tabs">
      <button data-tab="rooms" class="active">Occupied Rooms</button>
      <button data-tab="services">Service Requests</button>
      <button data-tab="food">Food Orders</button>
    </nav>

    <section id="rooms" class="active">
      <h2>Occupied Rooms</h2>
      <div id="roomsContainer">Loading...</div>
    </section>

    <section id="services">
      <h2>Service Requests</h2>
      <div id="servicesContainer">Loading...</div>
    </section>

    <section id="food">
      <h2>Food Orders</h2>
      <div id="foodContainer">Loading...</div>
    </section>

    <script>
      const tabs = document.querySelectorAll("nav.tabs button");
      const sections = document.querySelectorAll("section");

      tabs.forEach((tab) => {
        tab.addEventListener("click", () => {
          tabs.forEach((t) => t.classList.remove("active"));
          tab.classList.add("active");
          sections.forEach((s) => s.classList.remove("active"));
          document.getElementById(tab.dataset.tab).classList.add("active");
        });
      });

      const BASE_URL = "http://localhost:3000/api/manager";
      const logoutBtn = document.getElementById("logoutBtn");

      async function loadDashboard() {
        const token = localStorage.getItem("managerToken");
        if (!token) {
          window.location.href = "manager-login.html";
          return;
        }

        try {
          // Occupied Rooms
          const resRooms = await fetch(`${BASE_URL}/rooms`, {
            headers: { Authorization: `Bearer ${token}` },
          });
          const roomsData = await resRooms.json();
          const roomsContainer = document.getElementById("roomsContainer");
          roomsContainer.innerHTML = "";
          if (!roomsData.rooms || roomsData.rooms.length === 0) {
            roomsContainer.innerHTML = "<p>No occupied rooms.</p>";
          } else {
            const table = document.createElement("table");
            table.innerHTML = `<tr><th>Room No</th><th>Guest Name</th><th>No. of Guests</th><th>CheckIn</th><th>CheckOut</th></tr>`;
            roomsData.rooms.forEach((r) => {
              table.innerHTML += `<tr>
          <td>${r.Room_No}</td>
          <td>${r.Name}</td>
          <td>${r.Number_of_Guests}</td>
          <td>${new Date(r.CheckIn_Date).toLocaleDateString()}</td>
          <td>${new Date(r.CheckOut_Date).toLocaleDateString()}</td>
        </tr>`;
            });
            roomsContainer.appendChild(table);
          }

          // Service Requests
          const resServices = await fetch(`${BASE_URL}/services`, {
            headers: { Authorization: `Bearer ${token}` },
          });
          const servicesData = await resServices.json();
          const servicesContainer =
            document.getElementById("servicesContainer");
          servicesContainer.innerHTML = "";
          if (!servicesData.services || servicesData.services.length === 0) {
            servicesContainer.innerHTML = "<p>No service requests.</p>";
          } else {
            const table = document.createElement("table");
            table.innerHTML = `<tr><th>Guest</th><th>Room</th><th>Service</th><th>Date</th></tr>`;
            servicesData.services.forEach((s) => {
              table.innerHTML += `<tr>
          <td>${s.Guest_Name}</td>
          <td>${s.Room_No}</td>
          <td>${s.Service_Type}</td>
          <td>${new Date(s.Request_Date).toLocaleDateString()}</td>
        </tr>`;
            });
            servicesContainer.appendChild(table);
          }

          // Food Orders
          const resFood = await fetch(`${BASE_URL}/orders`, {
            headers: { Authorization: `Bearer ${token}` },
          });
          const foodData = await resFood.json();
          const foodContainer = document.getElementById("foodContainer");
          foodContainer.innerHTML = "";
          if (!foodData.orders || foodData.orders.length === 0) {
            foodContainer.innerHTML = "<p>No food orders.</p>";
          } else {
            const table = document.createElement("table");
            table.innerHTML = `<tr><th>Guest</th><th>Room</th><th>Item</th><th>Quantity</th><th>Status</th><th>Order Time</th></tr>`;
            foodData.orders.forEach((o) => {
              table.innerHTML += `<tr>
          <td>${o.Guest_Name}</td>
          <td>${o.Room_No}</td>
          <td>${o.Item_Name}</td>
          <td>${o.Quantity}</td>
          <td>${o.Status}</td>
          <td>${new Date(o.Order_Time).toLocaleString()}</td>
        </tr>`;
            });
            foodContainer.appendChild(table);
          }
        } catch (err) {
          console.error(err);
        }
      }

      // Logout
      logoutBtn.addEventListener("click", () => {
        localStorage.removeItem("managerToken");
        window.location.href = "manager_login.html";
      });

      // Load dashboard on page load
      loadDashboard();
    </script>
  </body>
</html>
